<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="copyright" content="Karl N. Redman 2004">
<meta name="keywords" content="run-free,GUI,command line launcher,application,xfree86,bash_history">
<meta name="description" content="run-free is a GUI command line lauching application for Xwindows">
<TITLE>run-free: GUI Command Line Launcher</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</head>
<BODY BGCOLOR="#FFFFFF">
<font size="-3">
<center>
<table>
<tr>
	<td><a href="http://run-free.sourceforge.net" target="top">Project Homepage</a></td>
	<td><a href="http://sourceforge.net/projects/run-free/" target="top">Sourceforge Page</a></td>
	<td><a href="http://cvs.sourceforge.net/viewcvs.py/run-free/" target="top">CVS Repository</a></td>
	<td><a href="http://freshmeat.net/projects/run-free/" target="top">Freshmeat.net Page</a></td>
	<td><a href="http://sourceforge.net/project/showfiles.php?group_id=39135&package_id=31325" target="top">Download project</a></td>
	<td><a href="http://www.sleepingstill.com" target="top">Author's Homepage</a></td>
</tr>
</table>
</center>
</font>
<hr>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>comboHandlers.c</h1><a href="comboHandlers_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*!\file comboHandlers.c</span>
00002 <span class="comment">  \brief Handle comboBox operations</span>
00003 <span class="comment"></span>
00004 <span class="comment">  The functions here are somewhat misplaced for now. I'll fix this in</span>
00005 <span class="comment">  run-free 3.0. Basically, the idea is that we are trying to handle</span>
00006 <span class="comment">  functionality that is based on the values of the combo box.</span>
00007 <span class="comment">*/</span>
00008 <span class="comment">/* NOTICE:</span>
00009 <span class="comment">    Copyright (C) 2004  Karl N. Redman (SleepingStill.com)</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
00012 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
00013 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
00014 <span class="comment">    (at your option) any later version.</span>
00015 <span class="comment"></span>
00016 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
00017 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00018 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00019 <span class="comment">    GNU General Public License for more details.</span>
00020 <span class="comment"></span>
00021 <span class="comment">    You should have received a copy of the GNU General Public License</span>
00022 <span class="comment">    along with this program; if not, write to the Free Software</span>
00023 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00024 <span class="comment"></span>
00025 <span class="comment">    For further information contact: parasyte@sleepingstill.com</span>
00026 <span class="comment">*/</span>
00027 
00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00030 <span class="preprocessor">#include &lt;string.h&gt;</span>
00031 <span class="preprocessor">#include &lt;gtk/gtk.h&gt;</span>
00032 
00033 <span class="preprocessor">#include &lt;<a class="code" href="config_8h.html">config.h</a>&gt;</span>
00034 
00035 <span class="preprocessor">#include "<a class="code" href="main_8h.html">main.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="comboHandlers_8h.html">comboHandlers.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00038 
00039 
00040 <span class="comment">//############## FUNCTION definition</span><span class="comment"></span>
00041 <span class="comment">/** </span>
00042 <span class="comment">    \brief Read the history file.</span>
00043 <span class="comment"></span>
00044 <span class="comment">    \author Karl N. Redman</span>
00045 <span class="comment"></span>
00046 <span class="comment">    \param list A list to populate (must be NULL) -probably</span>
00047 <span class="comment">    superfluious.</span>
00048 <span class="comment">    \param filename The filename of the file to read from</span>
00049 <span class="comment"></span>
00050 <span class="comment">    \return A populated GList.</span>
00051 <span class="comment"></span>
00052 <span class="comment">    \par Purpose:</span>
00053 <span class="comment">    Read a history file and populate a GList with it's data. The list</span>
00054 <span class="comment">    is populated in reverse of the file contents to accomidate for</span>
00055 <span class="comment">    (only) a file that is appended to.</span>
00056 <span class="comment">*/</span>
<a name="l00057"></a><a class="code" href="comboHandlers_8h.html#a2">00057</a> GList *<a class="code" href="comboHandlers_8h.html#a2">readHistory</a>(GList* list, <span class="keywordtype">char</span> *filename)
00058 {
00059   FILE *fp;
00060 <span class="comment"></span>
00061 <span class="comment">  /** \warning This caused alot of headeache. In the first place, gtk</span>
00062 <span class="comment">    GList operations are not intuitive at all. In the end it was</span>
00063 <span class="comment">    discovered that, because the values of the glist are pointers,</span>
00064 <span class="comment">    that we must use a persistant glist to populate our target</span>
00065 <span class="comment">    glist. What this means is that we end up passing in and returning</span>
00066 <span class="comment">    the same pointer (not the same address) in order to properly</span>
00067 <span class="comment">    populate our GList.</span>
00068 <span class="comment">  */</span>
00069 
00070   <span class="comment">//grab the environment $HOME directory</span>
00071   <span class="comment">//TODO</span>
00072   <span class="keywordflow">if</span>( (fp = fopen(filename, <span class="stringliteral">"a+"</span>) ) == NULL)
00073     {
00074       <a class="code" href="debug_8h.html#a3">dprint</a>(<span class="stringliteral">"run-free: bash_history file not found"</span>);
00075       <span class="comment"></span>
00076 <span class="comment">      /**\todo</span>
00077 <span class="comment">         we are not handling file operations properly here -I was</span>
00078 <span class="comment">         probably tired and lazy at the time. This MUST be fixed in</span>
00079 <span class="comment">         the near future!</span>
00080 <span class="comment">       */</span>
00081 
00082       <span class="comment">//ok, try a different file</span>
00083       <span class="comment">//TODO</span>
00084       <span class="comment">//else pop up a dialog</span>
00085     }
00086 
00087   <span class="comment">//max line length is the system max (this could be huge!)</span>
00088   <span class="keywordtype">char</span> line[<a class="code" href="comboHandlers_8h.html#a0">RF_LINE_MAX_LEN</a>+1];
00089   <span class="keywordtype">int</span> c;
00090   <span class="keywordtype">int</span> i =0, numItems =0;
00091   <span class="comment">//char *string;</span>
00092 
00093   memset(line, <span class="charliteral">'\0'</span>, <span class="keyword">sizeof</span>(line));
00094 
00095   <span class="keywordflow">do</span>
00096     {
00097       <span class="keywordflow">if</span>( (c = fgetc(fp)) == EOF)
00098         {
00099           <span class="comment">//dprint("end of file\n");</span>
00100           <span class="keywordflow">break</span>;
00101         }
00102       <span class="keywordflow">if</span>(c != <span class="charliteral">'\n'</span>)
00103         {
00104           line[i] = c;
00105           i++;
00106           <span class="keywordflow">continue</span>;
00107         }
00108       <span class="keywordflow">else</span>
00109         {
00110           i=0;
00111           <span class="keywordflow">if</span>(strcmp(line, <span class="stringliteral">"\n"</span>) == 0)
00112             {
00113               memset(line, <span class="charliteral">'\0'</span>, <span class="keyword">sizeof</span>(line));
00114               <span class="keywordflow">continue</span>;
00115             }
00116         }
00117 
00118       list = g_list_prepend(list, strdup(line));
00119       numItems++;
00120 
00121       memset(line, <span class="charliteral">'\0'</span>, <span class="keyword">sizeof</span>(line));
00122     }<span class="keywordflow">while</span>(1);
00123 
00124   fclose(fp);
00125 
00126   <span class="comment">//list = g_list_reverse(list);</span>
00127 
00128   <span class="comment">//eliminate duplicates</span>
00129   GList *newList = NULL;
00130 
00131   i=0;
00132 
00133   <span class="comment">//this is how we set the combo box length</span>
00134   <span class="comment">//int loop_num = RF_MAX_HISTLIST_LEN-1;</span>
00135   <span class="keywordtype">int</span> loop_num = <a class="code" href="main_8h.html#a6">history_len</a> -1;
00136 
00137   
00138   <span class="comment">//weed out duplicates and only keep the first instance of a history</span>
00139   <span class="comment">//line</span>
00140   <span class="keywordflow">for</span>(;i &lt; loop_num &amp;&amp; (list != NULL); i++, 
00141         list = g_list_next(list))
00142         {
00143 
00144           <span class="comment">//see if we've seen this one before</span>
00145            <span class="keywordflow">if</span>(g_list_find_custom(newList, list-&gt;data,
00146                                  (GCompareFunc)strcmp) == NULL) 
00147             {
00148               <span class="comment">//put the old command in the combo box</span>
00149               newList = g_list_append(newList, (<span class="keywordtype">char</span> *)list-&gt;data);
00150             }
00151            <span class="keywordflow">else</span>
00152              {
00153                <span class="comment">//increase the number of loops we're going to try and</span>
00154                <span class="comment">// grab the next one (unless NULL happens on next)</span>
00155                ++loop_num;
00156              }
00157         }<span class="comment">//end for</span>
00158 
00159   newList = g_list_prepend(newList, <span class="stringliteral">""</span>);
00160   <span class="keywordflow">return</span>(newList);
00161 }
00162 <span class="comment"></span>
00163 <span class="comment">/** </span>
00164 <span class="comment">    \brief Free up a GList and all it's members.</span>
00165 <span class="comment"></span>
00166 <span class="comment">    \author Karl N. Redman</span>
00167 <span class="comment"></span>
00168 <span class="comment">    \param list A pointer to a GList to be freed</span>
00169 <span class="comment"></span>
00170 <span class="comment">    \par Purpose:</span>
00171 <span class="comment">    Frees the points in the GList and then the GList pointer itself.</span>
00172 <span class="comment">*/</span>
<a name="l00173"></a><a class="code" href="comboHandlers_8h.html#a1">00173</a> <span class="keywordtype">void</span> <a class="code" href="comboHandlers_8h.html#a1">freeList</a>(GList *list)
00174 {
00175   <span class="keywordtype">int</span> i =0;
00176   <span class="keywordflow">for</span>(; i &lt; (<span class="keywordtype">int</span>)g_list_length(list); i++, list = list-&gt;next)
00177     free(list-&gt;data);
00178   
00179   g_list_free(list);
00180 }
00181 
00182 <span class="comment"></span>
00183 <span class="comment">/** </span>
00184 <span class="comment">    \brief write a history file.</span>
00185 <span class="comment"></span>
00186 <span class="comment">    \author Karl N. Redman</span>
00187 <span class="comment"></span>
00188 <span class="comment">    \param command the command to append to the file</span>
00189 <span class="comment">    \param filename the file to append the command to</span>
00190 <span class="comment"></span>
00191 <span class="comment">    \par</span>
00192 <span class="comment">    Purpose:</span>
00193 <span class="comment">    Appends the command to the end of the file</span>
00194 <span class="comment">*/</span>
<a name="l00195"></a><a class="code" href="comboHandlers_8h.html#a3">00195</a> <span class="keywordtype">int</span> <a class="code" href="comboHandlers_8h.html#a3">writeHistory</a>(<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> *filename)
00196 {
00197   <span class="comment">//always writes to the end of the file</span>
00198 
00199   FILE *fp;
00200   <span class="keywordtype">int</span> retval = 0;
00201   <span class="keywordtype">int</span> wLen = 0;
00202 
00203   
00204   fp = fopen(filename, <span class="stringliteral">"a+"</span>);
00205   <span class="keywordflow">if</span>(fp == NULL)
00206     {<span class="comment"></span>
00207 <span class="comment">      /**\todo FIX THIS I'm not handling file operations properly</span>
00208 <span class="comment">      -probably tired at the time... -parasyte.</span>
00209 <span class="comment">      */</span>
00210       <span class="comment">//display dialog</span>
00211     }
00212 
00213   <span class="comment">//write command line to file</span>
00214   <span class="keywordflow">if</span>((wLen = fputs(<a class="code" href="main_8h.html#a8">command</a>, fp)) &gt; 0)
00215     {
00216       retval = -1;
00217     }
00218   <span class="comment">//else write a new line</span>
00219    fputs(<span class="stringliteral">"\n"</span>, fp);
00220 
00221   fclose(fp);                   <span class="comment">// close file</span>
00222 
00223   <span class="keywordflow">return</span> retval;
00224 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Mar 17 14:38:21 2004 for run-free by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
