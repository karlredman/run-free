<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="copyright" content="Karl N. Redman 2004">
<meta name="keywords" content="run-free,GUI,command line launcher,application,xfree86,bash_history">
<meta name="description" content="run-free is a GUI command line lauching application for Xwindows">
<TITLE>run-free: GUI Command Line Launcher</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</head>
<BODY BGCOLOR="#FFFFFF">
<font size="-3">
<center>
<table>
<tr>
	<td><a href="http://run-free.sourceforge.net" target="top">Project Homepage</a></td>
	<td><a href="http://sourceforge.net/projects/run-free/" target="top">Sourceforge Page</a></td>
	<td><a href="http://cvs.sourceforge.net/viewcvs.py/run-free/" target="top">CVS Repository</a></td>
	<td><a href="http://freshmeat.net/projects/run-free/" target="top">Freshmeat.net Page</a></td>
	<td><a href="http://sourceforge.net/project/showfiles.php?group_id=39135&package_id=31325" target="top">Download project</a></td>
	<td><a href="http://www.sleepingstill.com" target="top">Author's Homepage</a></td>
</tr>
</table>
</center>
</font>
<hr>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>main.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
run-free main file 
<p>
run-free is a command line launching program written in gtk. This version of run-free is written is C for gtk+1.2
<p>
Definition in file <a class="el" href="main_8c-source.html">main.c</a>.
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;gtk/gtk.h&gt;</code><br>
<code>#include "<a class="el" href="interface_8h-source.html">interface.h</a>"</code><br>
<code>#include "<a class="el" href="support_8h-source.html">support.h</a>"</code><br>
<code>#include "<a class="el" href="main_8h-source.html">main.h</a>"</code><br>
<code>#include "<a class="el" href="comboBox_8h-source.html">comboBox.h</a>"</code><br>
<code>#include "<a class="el" href="kbhit_8h-source.html">kbhit.h</a>"</code><br>
<code>#include "<a class="el" href="commonDefs_8h-source.html">commonDefs.h</a>"</code><br>
<code>#include "<a class="el" href="debug_8h-source.html">debug.h</a>"</code><br>
<code>#include "<a class="el" href="comboHandlers_8h-source.html">comboHandlers.h</a>"</code><br>
<code>#include "<a class="el" href="help_8h-source.html">help.h</a>"</code><br>
<code>#include &lt;getopt.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>

<p>
Include dependency graph for main.c:<p><center><img src="main_8c__incl.png" border="0" usemap="#main.c_map" alt="Include dependency graph"></center>
<map name="main.c_map">
<area href="support_8h.html" shape="rect" coords="284,86,348,105" alt="">
<area href="interface_8h.html" shape="rect" coords="372,86,441,105" alt="">
<area href="main_8h.html" shape="rect" coords="465,86,513,105" alt="">
<area href="comboBox_8h.html" shape="rect" coords="537,86,620,105" alt="">
<area href="kbhit_8h.html" shape="rect" coords="644,86,692,105" alt="">
<area href="commonDefs_8h.html" shape="rect" coords="716,86,812,105" alt="">
<area href="debug_8h.html" shape="rect" coords="836,86,892,105" alt="">
<area href="comboHandlers_8h.html" shape="rect" coords="916,86,1028,105" alt="">
<area href="help_8h.html" shape="rect" coords="1052,86,1097,105" alt="">
</map>

<p>
<a href="main_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>getopt externs</h2></td></tr>
<tr><td colspan=2>externs from getopt functionality <br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>char *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a0">optarg</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">command line options  <a href="#a0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a1">optind</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">option arguments  <a href="#a1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a2">opterr</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">option arguments  <a href="#a2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a3">optopt</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">option arguments  <a href="#a3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>char **&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a4">environ</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the environment  <a href="#a4"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a5">main</a> (int argc, char *argv[], char *env[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The Main.  <a href="#a5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="main_8c.html#a6">run_command</a> (char *<a class="el" href="main_8h.html#a8">command</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run a command.  <a href="#a6"></a><br><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="main.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[], </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>env</em>[]</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The Main. 
<p>
Long mian function that is intended to be split up some day 
<p>
get the user's home directory<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>cleanup getopt stuff -it's messy! <p>
add cleanup routines</dd></dl>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00078">78</a> of file <a class="el" href="main_8c-source.html">main.c</a>.
<p>
References <a class="el" href="config_8h-source.html#l00005">BASH_HISTORY_FILENAME</a>, <a class="el" href="main_8h-source.html#l00057">bash_shell_mode</a>, <a class="el" href="comboBox_8h-source.html#l00039">cbitems</a>, <a class="el" href="interface_8h-source.html#l00050">checkbutton</a>, <a class="el" href="interface_8h-source.html#l00046">combo1</a>, <a class="el" href="callbacks_8h.html#a18">combo_init()</a>, <a class="el" href="comboBox_8h-source.html#l00041">combo_mode</a>, <a class="el" href="main_8h-source.html#l00054">command</a>, <a class="el" href="config_8h-source.html#l00008">COPYRIGHT</a>, <a class="el" href="interface_8c-source.html#l00282">create_fileselection()</a>, <a class="el" href="interface_8c-source.html#l00047">create_mainWindow()</a>, <a class="el" href="debug_8h-source.html#l00060">DEBUG_MODE</a>, <a class="el" href="config_8h-source.html#l00011">DEFAULT_HISTORY_LEN</a>, <a class="el" href="config_8h-source.html#l00014">DEFAULT_TERMINAL_PATH</a>, <a class="el" href="main_8h-source.html#l00039">die</a>, <a class="el" href="kbhit_8c-source.html#l00040">do_kbhit()</a>, <a class="el" href="debug_8h-source.html#l00075">dprint</a>, <a class="el" href="debug_8h-source.html#l00079">dprint_s2</a>, <a class="el" href="interface_8h-source.html#l00033">fileselection</a>, <a class="el" href="comboHandlers_8c-source.html#l00173">freeList()</a>, <a class="el" href="main_8h-source.html#l00049">history_file</a>, <a class="el" href="main_8h-source.html#l00050">history_len</a>, <a class="el" href="main_8h-source.html#l00048">home_directory</a>, <a class="el" href="main_8h-source.html#l00041">keep_open</a>, <a class="el" href="help_8h-source.html#l00031">KEYSTROKES</a>, <a class="el" href="config_8h-source.html#l00053">LICENSE</a>, <a class="el" href="interface_8h-source.html#l00032">mainWindow</a>, <a class="el" href="main_8h-source.html#l00040">no_kbhit</a>, <a class="el" href="main_8c-source.html#l00067">optarg</a>, <a class="el" href="commonDefs_8h-source.html#l00040">OPTARG_HISTORY</a>, <a class="el" href="commonDefs_8h-source.html#l00042">OPTARG_HISTORY_FILETYPE_BASH</a>, <a class="el" href="commonDefs_8h-source.html#l00041">OPTARG_HISTORY_FILETYPE_RF</a>, <a class="el" href="commonDefs_8h-source.html#l00043">OPTARG_HISTORY_LEN</a>, <a class="el" href="config_8h-source.html#l00056">PACKAGE</a>, <a class="el" href="commonDefs_8h-source.html#l00039">RF_HISTORY_FILENAME</a>, <a class="el" href="comboBox_8h-source.html#l00034">RF_HISTORY_MODE</a>, <a class="el" href="main_8h-source.html#l00038">run_in_term</a>, <a class="el" href="main_8h-source.html#l00051">terminal_path</a>, <a class="el" href="config_8h-source.html#l00077">USER_HISTORY_FILENAME</a>, and <a class="el" href="config_8h-source.html#l00083">VERSION</a>.
<p>
<div class="fragment"><pre>00079 {
00080   gboolean gui =TRUE, history_set =FALSE, listops = FALSE;
00081   
00082 
00083   <span class="keywordtype">int</span> opt =0;
00084 
00085 
00086   <span class="comment">/*Global_Initialization -Items initialized for runtime</span>
00087 <span class="comment">   */</span>
00088   <a class="code" href="main_8h.html#a5">history_file</a> = NULL;          
00089   <a class="code" href="main_8h.html#a8">command</a> = NULL;
00090   <a class="code" href="main_8h.html#a7">terminal_path</a> = NULL;
00091   <a class="code" href="main_8h.html#a1">die</a> = TRUE;                   
00092   <a class="code" href="main_8h.html#a0">run_in_term</a> = FALSE;          
00093   <a class="code" href="main_8h.html#a2">no_kbhit</a> = FALSE;
00094   <a class="code" href="comboBox_8h.html#a4">combo_mode</a> = <a class="code" href="comboBox_8h.html#a1">RF_HISTORY_MODE</a>; 
00095   <a class="code" href="main_8h.html#a3">keep_open</a> = FALSE;
00096 
00097   <span class="comment">//init gtk stuff</span>
00098   gtk_set_locale ();
00099   gtk_init (&amp;argc, &amp;argv);
00100 
00101   <span class="keywordtype">char</span> *<a class="code" href="main_8h.html#a4">home_directory</a> = getenv(<span class="stringliteral">"HOME"</span>); <span class="comment">/*! get the user's home directory */</span>
00102 
00103   <span class="comment">//show debug mode message</span>
00104   <a class="code" href="debug_8h.html#a3">dprint</a>(<span class="stringliteral">"run-free: debug mode enabled"</span>);
00105 
00106   <span class="comment">//loop through the argument options</span>
00107   <span class="keywordflow">while</span>(1)
00108     {
00109       <span class="keywordtype">int</span> option_index = 0;
00110       <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[] = {
00111         {<span class="stringliteral">"bash"</span>, 0, 0, <span class="charliteral">'b'</span>},
00112         {<span class="stringliteral">"command"</span>, 1, 0, <span class="charliteral">'c'</span>},
00113         {<span class="stringliteral">"die"</span>, 0, 0, <span class="charliteral">'d'</span>},
00114         {<span class="stringliteral">"help"</span>, 0, 0, <span class="charliteral">'h'</span>},
00115         {<span class="stringliteral">"histlen"</span>, 1, 0, 0},
00116         {<span class="stringliteral">"history"</span>, 1, 0, 0},
00117         {<span class="stringliteral">"kbhit"</span>, 0, 0, <span class="charliteral">'k'</span>},
00118         {<span class="stringliteral">"nokbhit"</span>, 0, 0, <span class="charliteral">'i'</span>},
00119         {<span class="stringliteral">"keystrokes"</span>, 0, 0, <span class="charliteral">'y'</span>},
00120         {<span class="stringliteral">"listops"</span>, 0, 0, <span class="charliteral">'l'</span>},
00121         {<span class="stringliteral">"termstay"</span>, 0, 0, <span class="charliteral">'o'</span>},
00122         {<span class="stringliteral">"runterm"</span>, 0, 0, <span class="charliteral">'r'</span>},
00123         {<span class="stringliteral">"terminal"</span>, 1, 0, <span class="charliteral">'t'</span>},
00124         {<span class="stringliteral">"version"</span>, 0, 0, <span class="charliteral">'V'</span>},
00125         <span class="comment">//{"smart", 0, 0, 's'},</span>
00126         {0, 0, 0, 0}
00127       };
00128 <span class="comment"></span>
00129 <span class="comment">      /**\todo cleanup getopt stuff -it's messy! */</span>
00130 
00131       <span class="comment">//do command line processing</span>
00132       opt = getopt_long(argc, argv, <span class="stringliteral">"bc:dhiklort:yV"</span>, long_options, &amp;option_index);
00133 
00134       <span class="keywordflow">if</span>(opt == -1)
00135         <span class="keywordflow">break</span>;
00136       
00137       <span class="keywordflow">switch</span>(opt)
00138         {
00139         <span class="keywordflow">case</span> 0:         <span class="comment">//long arguments</span>
00140           <span class="keywordflow">if</span>(strcmp(long_options[option_index].name, OPTARG_HISTORY) ==0)
00141             {
00142               <span class="comment">//handle history file</span>
00143               <span class="keywordflow">if</span>(strcmp(optarg, OPTARG_HISTORY_FILETYPE_RF)==0) <span class="comment">//run-free</span>
00144                 {
00145                   <a class="code" href="main_8h.html#a5">history_file</a> = g_malloc(strlen(home_directory)+strlen(RF_HISTORY_FILENAME)+2);
00146                   sprintf(history_file, <span class="stringliteral">"%s/%s"</span>, home_directory, RF_HISTORY_FILENAME);
00147                 }
00148               <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(optarg, OPTARG_HISTORY_FILETYPE_BASH)==0) <span class="comment">//bash</span>
00149                 {
00150                   <a class="code" href="main_8h.html#a5">history_file</a> = g_malloc(strlen(home_directory)+strlen(BASH_HISTORY_FILENAME)+2);
00151                   sprintf(history_file, <span class="stringliteral">"%s/%s"</span>, home_directory, BASH_HISTORY_FILENAME);
00152                 }
00153               <span class="keywordflow">else</span>
00154                 {
00155                   <a class="code" href="main_8h.html#a5">history_file</a> = g_malloc(strlen(optarg)+1);
00156                   sprintf(history_file,<span class="stringliteral">"%s"</span>, optarg); <span class="comment">//xxx</span>
00157                 }
00158               history_set++;
00159             }
00160           <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(long_options[option_index].name, OPTARG_HISTORY_LEN) ==0)
00161             {
00162               <a class="code" href="main_8h.html#a6">history_len</a> = atol(optarg);
00163             }
00164           <span class="keywordflow">break</span>;
00165         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
00166           <a class="code" href="main_8h.html#a9">bash_shell_mode</a> = TRUE;
00167           <span class="keywordflow">break</span>;
00168         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00169           <span class="comment">//copy command from command line</span>
00170           <span class="keywordflow">if</span>(<a class="code" href="main_8c.html#a0">optarg</a>)
00171             {
00172               <a class="code" href="main_8h.html#a8">command</a> = g_malloc(strlen(optarg)+1);
00173               sprintf(command, <span class="stringliteral">"%s"</span>, optarg);           <span class="comment">/* copy the string */</span>
00174             }
00175           <span class="keywordflow">break</span>;
00176         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00177           <a class="code" href="main_8h.html#a1">die</a> = FALSE;
00178           <span class="keywordflow">break</span>;
00179         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00180           g_print(<span class="stringliteral">"%s: version %s.\n%s\n"</span>, PACKAGE, VERSION, COPYRIGHT);
00181           g_print(<span class="stringliteral">"%s\n\n"</span>, LICENSE);
00182           g_print(<span class="stringliteral">"\nHELP:\n"</span>);
00183           <span class="keywordtype">char</span> *help = 
00184             <span class="stringliteral">"-b, --bash\t\tRun in Bash mode (reads ~/.bashrc before execution)"</span>
00185             <span class="stringliteral">"\n"</span>
00186             <span class="stringliteral">"-c, --command=COMMAND\tSet COMMAND in entry box on startup"</span>
00187             <span class="stringliteral">"\n"</span>
00188             <span class="stringliteral">"-d, --die\t\tDo NOT die after executing a command"</span>
00189             <span class="stringliteral">"\n"</span>
00190             <span class="stringliteral">"-h, --help\t\tThis help list"</span>
00191             <span class="stringliteral">"\n"</span>
00192             <span class="stringliteral">"    --histlen=NUM\tShow NUM items from history in history list"</span>
00193             <span class="stringliteral">"\n"</span>
00194             <span class="stringliteral">"    --history=FILEPATH\tUse history file from FILEPATH"</span>
00195             <span class="stringliteral">"\n"</span>
00196             <span class="stringliteral">"-i, --nokbhit\t\tDo NOT allow keyboard hit mode (DON'T show \"HIT ANY KEY\" on exit)"</span>
00197             <span class="stringliteral">"\n"</span>
00198             <span class="stringliteral">"-k, --kbhit\t\tRun in keyboard hit mode (show \"HIT ANY KEY\" and exit)"</span>
00199             <span class="stringliteral">"\n"</span>
00200             <span class="stringliteral">"-l, --listops\t\tList default (compiled in) options and exit"</span>
00201             <span class="stringliteral">"\n"</span>
00202             <span class="stringliteral">"-o, --termstay\t\tKeep the terminal open after command exec"</span>
00203             <span class="stringliteral">"\n"</span>
00204             <span class="stringliteral">"-r, --runterm\t\tSet run_in_term mode on startup"</span>
00205             <span class="stringliteral">"\n"</span>
00206             <span class="stringliteral">"-t, --terminal=TERMPATH\tUse TERMPATH program for run_in_terminal mode"</span>
00207             <span class="stringliteral">"\n"</span>
00208             <span class="stringliteral">"-y, --keystrokes\tDisplay the keystrokes for run-free"</span>
00209             <span class="stringliteral">"\n"</span>
00210             <span class="stringliteral">"-V, --version\t\tShow version and copyright information"</span>
00211             <span class="stringliteral">"\n"</span>;
00212           g_print(<span class="stringliteral">"%s"</span>, help);
00213           exit(0);
00214           <span class="keywordflow">break</span>;
00215         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
00216           <a class="code" href="main_8h.html#a2">no_kbhit</a> = TRUE;
00217           <span class="keywordflow">break</span>;
00218         <span class="keywordflow">case</span> <span class="charliteral">'k'</span>:
00219           gui = FALSE;
00220           <span class="keywordflow">break</span>;
00221         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00222           listops = TRUE;
00223           <span class="keywordflow">break</span>;
00224         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
00225           <a class="code" href="main_8h.html#a3">keep_open</a> = TRUE;
00226           <span class="keywordflow">break</span>;
00227         <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
00228           <a class="code" href="main_8h.html#a0">run_in_term</a> = TRUE;
00229           <span class="keywordflow">break</span>;
00230         <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
00231           <span class="keywordflow">if</span>(<a class="code" href="main_8c.html#a0">optarg</a>)
00232             {
00233               <a class="code" href="main_8h.html#a7">terminal_path</a> = g_malloc(strlen(optarg)+1);
00234               sprintf(terminal_path, <span class="stringliteral">"%s"</span>, optarg);
00235             }
00236           <span class="keywordflow">break</span>;
00237         <span class="keywordflow">case</span> <span class="charliteral">'y'</span>:
00238           g_print(<span class="stringliteral">"%s: version %s.\n%s\n"</span>, PACKAGE, VERSION, COPYRIGHT);
00239           g_print(<span class="stringliteral">"%s\n\n"</span>, LICENSE);
00240           g_print(<span class="stringliteral">"\nKEYSTROKES:\n"</span>);
00241           g_print(<span class="stringliteral">"%s\n"</span>,KEYSTROKES);
00242 <span class="comment"></span>
00243 <span class="comment">          /**\todo add cleanup routines */</span>
00244 
00245           <span class="comment">//cleanup</span>
00246           <a class="code" href="comboHandlers_8h.html#a1">freeList</a>(cbitems);
00247           g_free(history_file);
00248           g_free(home_directory);
00249           g_free(command);
00250           g_free(terminal_path);
00251           exit(0);
00252           <span class="keywordflow">break</span>;
00253         <span class="keywordflow">case</span> <span class="charliteral">'V'</span>:
00254           g_print(<span class="stringliteral">"%s: version %s.\n%s\n"</span>, PACKAGE, VERSION, COPYRIGHT);
00255           g_print(<span class="stringliteral">"%s\n\n"</span>, LICENSE);
00256           exit(0);
00257           <span class="keywordflow">break</span>;
00258         <span class="keywordflow">default</span>:
00259           <a class="code" href="debug_8h.html#a3">dprint</a>(<span class="stringliteral">"an argument is not being delt with"</span>);
00260           <span class="keywordflow">break</span>;
00261         }
00262     }
00263   
00264 
00265   <span class="comment">//handle options not set</span>
00266   <span class="keywordflow">if</span>(!history_set)
00267     {
00268       <span class="comment">//string terminators are accounted for</span>
00269 <span class="preprocessor">#ifdef USE_USER_HISTORY_FILENAME </span>
00270 <span class="preprocessor"></span>      <a class="code" href="debug_8h.html#a5">dprint_s2</a>(<span class="stringliteral">"user history compile option"</span>,USER_HISTORY_FILENAME);
00271       <a class="code" href="main_8h.html#a5">history_file</a> = g_malloc(strlen(USER_HISTORY_FILENAME)+1);
00272       sprintf(history_file, <span class="stringliteral">"%s"</span>, USER_HISTORY_FILENAME);
00273 <span class="preprocessor">#else </span>
00274 <span class="preprocessor"></span>      <a class="code" href="debug_8h.html#a5">dprint_s2</a>(<span class="stringliteral">"bash history compile option"</span>,BASH_HISTORY_FILENAME);
00275       <a class="code" href="main_8h.html#a5">history_file</a> = g_malloc(strlen(home_directory)+strlen(BASH_HISTORY_FILENAME)+2);
00276       sprintf(history_file, <span class="stringliteral">"%s/%s"</span>, home_directory, BASH_HISTORY_FILENAME);
00277 <span class="preprocessor">#endif</span>
00278 <span class="preprocessor"></span>    }
00279 
00280   <span class="keywordflow">if</span>(!<a class="code" href="main_8h.html#a6">history_len</a>)
00281     <a class="code" href="main_8h.html#a6">history_len</a> = <a class="code" href="config_8h.html#a2">DEFAULT_HISTORY_LEN</a>;
00282 
00283   <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a7">terminal_path</a> == NULL)
00284     {
00285       <a class="code" href="main_8h.html#a7">terminal_path</a> = g_malloc(strlen(DEFAULT_TERMINAL_PATH)+1);
00286       sprintf(terminal_path, <span class="stringliteral">"%s"</span>, DEFAULT_TERMINAL_PATH);
00287     }
00288 
00289   <span class="keywordflow">if</span>(listops)
00290     {
00291       g_print(<span class="stringliteral">"%s: version %s.\n%s\n"</span>, PACKAGE, VERSION, COPYRIGHT);
00292       g_print(<span class="stringliteral">"%s\n\n"</span>, LICENSE);
00293       g_print(<span class="stringliteral">"\n"</span>);
00294 
00295 <span class="preprocessor">#ifdef USE_USER_HISTORY_FILENAME</span>
00296 <span class="preprocessor"></span>      <span class="keywordtype">char</span> *use_user_history_filename = <span class="stringliteral">"yes"</span>;
00297 <span class="preprocessor">#else</span>
00298 <span class="preprocessor"></span>      <span class="keywordtype">char</span> *use_user_history_filename = <span class="stringliteral">"no"</span>;
00299 <span class="preprocessor">#endif</span>
00300 <span class="preprocessor"></span>      <span class="comment">//list the default run-time options and exit</span>
00301       g_print(<span class="stringliteral">"debug mode \t\t\t\t=%s\n"</span>, DEBUG_MODE?<span class="stringliteral">"yes"</span>:<span class="stringliteral">"no"</span>);
00302       g_print(<span class="stringliteral">"default history display length\t\t=%d\n"</span>, history_len);
00303       g_print(<span class="stringliteral">"use user history file by default\t=%s\n"</span>,use_user_history_filename);
00304       g_print(<span class="stringliteral">"name of default user history file: %s\n"</span>, USER_HISTORY_FILENAME);
00305       g_print(<span class="stringliteral">"name of default bash history file:%s/%s\n"</span>, home_directory, BASH_HISTORY_FILENAME);
00306       g_print(<span class="stringliteral">"run_in_term mode terminal path:%s\n"</span>, terminal_path);
00307       exit(0);
00308     }
00309 
00310   <span class="comment">//post handle command line options </span>
00311   <span class="keywordflow">if</span>(!gui)
00312     {
00313         <a class="code" href="kbhit_8c.html#a1">do_kbhit</a>();
00314       
00315       <span class="comment">//cleanup</span>
00316       <a class="code" href="comboHandlers_8h.html#a1">freeList</a>(cbitems);
00317       g_free(history_file);
00318       g_free(home_directory);
00319       g_free(command);
00320       g_free(terminal_path);
00321     }
00322   <span class="keywordflow">else</span>
00323     {
00324       <span class="comment">//already did this</span>
00325       <span class="comment">//gtk_set_locale ();</span>
00326       <span class="comment">//gtk_init (&amp;argc, &amp;argv);</span>
00327     
00328       <span class="comment">//create the main window</span>
00329       <a class="code" href="interface_8h.html#a0">mainWindow</a> = <a class="code" href="interface_8c.html#a0">create_mainWindow</a> ();
00330       gtk_widget_show (mainWindow);
00331 
00332       <span class="comment">//we create it but don't show it until it's needed</span>
00333       <a class="code" href="interface_8h.html#a1">fileselection</a> = <a class="code" href="interface_8c.html#a1">create_fileselection</a> ();
00334 
00335       <span class="comment">//set the state of the run_in_term button</span>
00336       <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a0">run_in_term</a>)
00337         {
00338           <a class="code" href="main_8h.html#a0">run_in_term</a> = FALSE;  <span class="comment">/* cheezy */</span>
00339           gtk_button_clicked(GTK_BUTTON(checkbutton)); 
00340         }
00341 
00342       <span class="comment">//initialize the combo box in history mode</span>
00343       <a class="code" href="callbacks_8h.html#a18">combo_init</a>(RF_HISTORY_MODE);
00344 
00345       <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a8">command</a> !=NULL)
00346         {
00347           <span class="comment">//gtk_entry_set_text(combo_entry1, command);</span>
00348           gtk_entry_set_text(GTK_ENTRY(GTK_COMBO(combo1)-&gt;entry), command);
00349           <a class="code" href="debug_8h.html#a5">dprint_s2</a>(<span class="stringliteral">"startup command"</span>, command);
00350         }
00351       
00352       <span class="comment">//run the program</span>
00353       gtk_main ();
00354     }
00355 
00356   <span class="keywordflow">return</span> 0;
00357 }
</pre></div>    </td>
  </tr>
</table>

<p>
Here is the call graph for this function:<p><center><img src="main_8c_a5_cgraph.png" border="0" usemap="#main_8c_a5_cgraph_map" alt=""></center>
<map name="main_8c_a5_cgraph_map">
<area href="callbacks_8h.html#a18" shape="rect" coords="767,174,839,193" alt="">
<area href="interface_8c.html#a1" shape="rect" coords="111,141,231,159" alt="">
<area href="interface_8c.html#a0" shape="rect" coords="107,439,235,458" alt="">
<area href="comboHandlers_8h.html#a1" shape="rect" coords="597,675,651,694" alt="">
<area href="kbhit_8c.html#a1" shape="rect" coords="141,746,200,765" alt="">
<area href="callbacks_8c.html#a9" shape="rect" coords="309,183,477,202" alt="">
<area href="callbacks_8c.html#a17" shape="rect" coords="304,55,483,74" alt="">
<area href="callbacks_8c.html#a10" shape="rect" coords="292,98,495,117" alt="">
<area href="callbacks_8c.html#a8" shape="rect" coords="321,141,465,159" alt="">
<area href="callbacks_8c.html#a6" shape="rect" coords="315,525,472,543" alt="">
<area href="callbacks_8c.html#a7" shape="rect" coords="317,567,469,586" alt="">
<area href="callbacks_8c.html#a3" shape="rect" coords="309,610,477,629" alt="">
<area href="callbacks_8c.html#a5" shape="rect" coords="285,311,501,330" alt="">
<area href="callbacks_8c.html#a4" shape="rect" coords="307,269,480,287" alt="">
<area href="callbacks_8c.html#a2" shape="rect" coords="316,653,471,671" alt="">
<area href="callbacks_8c.html#a11" shape="rect" coords="289,226,497,245" alt="">
<area href="callbacks_8c.html#a13" shape="rect" coords="313,397,473,415" alt="">
<area href="callbacks_8c.html#a16" shape="rect" coords="300,439,487,458" alt="">
<area href="callbacks_8c.html#a12" shape="rect" coords="325,354,461,373" alt="">
<area href="callbacks_8c.html#a15" shape="rect" coords="316,482,471,501" alt="">
<area href="callbacks_8h.html#a19" shape="rect" coords="560,263,688,282" alt="">
<area href="interface_8c.html#a2" shape="rect" coords="567,221,681,239" alt="">
<area href="main_8h.html#a10" shape="rect" coords="577,357,671,375" alt="">
<area href="comboHandlers_8h.html#a3" shape="rect" coords="763,357,843,375" alt="">
<area href="callbacks_8c.html#a19" shape="rect" coords="747,221,859,239" alt="">
<area href="callbacks_8c.html#a14" shape="rect" coords="552,450,696,469" alt="">
<area href="kbhit_8c.html#a3" shape="rect" coords="343,789,444,807" alt="">
<area href="kbhit_8c.html#a2" shape="rect" coords="349,746,437,765" alt="">
</map>
<a class="anchor" name="a6" doxytag="main.c::run_command" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void run_command </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>command</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Run a command. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Karl N. Redman</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>command</em>&nbsp;</td><td>The command we want to run</td></tr>
  </table>
</dl>
<b> Purpose:</b> Execute the command in a way that is consistant with the design of run-free.<p>
<dl compact><dt><b>Note:</b></dt><dd>This is a custom system() type call in order to handle environment settings properly (in the future) if this program is to be a setuid application (which is in the works) </dd></dl>

<p>
<dl compact><dt><b>Warning:</b></dt><dd>NOTE: this function is a potential security problem because we are not replacing the environment. if this is ever going to be a SUID application then I need to handle this. I'll work on this in the future -parasyte </dd></dl>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00380">380</a> of file <a class="el" href="main_8c-source.html">main.c</a>.
<p>
References <a class="el" href="main_8h-source.html#l00057">bash_shell_mode</a>, <a class="el" href="callbacks_8h.html#a18">combo_init()</a>, <a class="el" href="comboBox_8h-source.html#l00041">combo_mode</a>, <a class="el" href="main_8h-source.html#l00054">command</a>, <a class="el" href="main_8h-source.html#l00039">die</a>, <a class="el" href="main_8c-source.html#l00071">environ</a>, <a class="el" href="main_8h-source.html#l00049">history_file</a>, <a class="el" href="main_8h-source.html#l00041">keep_open</a>, <a class="el" href="main_8h-source.html#l00040">no_kbhit</a>, <a class="el" href="main_8h-source.html#l00038">run_in_term</a>, <a class="el" href="main_8h-source.html#l00051">terminal_path</a>, and <a class="el" href="comboHandlers_8c-source.html#l00195">writeHistory()</a>.
<p>
Referenced by <a class="el" href="callbacks_8c-source.html#l00099">on_combo_entry1_key_press_event()</a>, and <a class="el" href="callbacks_8c-source.html#l00352">on_runButton_clicked()</a>.
<p>
<div class="fragment"><pre>00381 {
00382 
00383   <span class="keywordtype">char</span> pre[64], post[64], *buffer;
00384 
00385   <span class="comment">//anything except NULL is allowed.</span>
00386   <span class="keywordflow">if</span>(!<a class="code" href="main_8h.html#a8">command</a>)
00387     <span class="keywordflow">return</span>;
00388 
00389   <span class="comment">//populate parts of the command</span>
00390   <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a0">run_in_term</a>)
00391     {
00392       <span class="comment">//we want to run this in a terminal so act accordingly</span>
00393       <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a9">bash_shell_mode</a> == TRUE)
00394         {
00395           <span class="comment">//endable user alias settings (i.e. ls --color)</span>
00396           strcpy(pre,<span class="stringliteral">" -e bash -i -c \'"</span>);
00397         }
00398       <span class="keywordflow">else</span>
00399         {
00400           strcpy(pre,<span class="stringliteral">" -e sh -c \'"</span>);
00401         }
00402 
00403       <span class="keywordflow">if</span>(!<a class="code" href="main_8h.html#a2">no_kbhit</a>)
00404         {
00405           <span class="comment">//alsways show "HIT ANY KEY"</span>
00406           <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a3">keep_open</a>)
00407             <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a9">bash_shell_mode</a> == TRUE)
00408               strcpy(post, <span class="stringliteral">";  bash -i \'&amp;"</span>);
00409             <span class="keywordflow">else</span>
00410               strcpy(post, <span class="stringliteral">";  sh \'&amp;"</span>);
00411           <span class="keywordflow">else</span>
00412             strcpy(post, <span class="stringliteral">"; run-free -k \'&amp;"</span>);
00413         }
00414       <span class="keywordflow">else</span>
00415         <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a3">keep_open</a>)
00416             <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a9">bash_shell_mode</a> == TRUE)
00417               strcpy(post, <span class="stringliteral">";  bash -i \'&amp;"</span>);
00418             <span class="keywordflow">else</span>
00419               strcpy(post, <span class="stringliteral">";  sh \'&amp;"</span>);
00420         <span class="keywordflow">else</span>
00421           strcpy(post, <span class="stringliteral">"; \'&amp;"</span>);
00422         
00423 
00424       <span class="comment">//allocate a buffer</span>
00425       buffer = g_malloc(strlen(terminal_path)
00426                       +strlen(pre)
00427                       +strlen(command)
00428                       +strlen(post)
00429                       +1);
00430       
00431       <span class="comment">//populate the buffer with the command</span>
00432       sprintf(buffer, <span class="stringliteral">"%s%s%s%s"</span>, terminal_path, pre, command, post);
00433     }
00434   <span class="keywordflow">else</span>
00435     {
00436       <span class="comment">//no terminal, we must want to just execute something in the</span>
00437       <span class="comment">//background</span>
00438       strcpy(pre, <span class="stringliteral">""</span>);
00439       strcpy(post, <span class="stringliteral">" &amp;"</span>);
00440 
00441       <span class="comment">//allocate a buffer</span>
00442       buffer = g_malloc( +strlen(pre)
00443                       +strlen(command)
00444                       +strlen(post)
00445                       +1);
00446       
00447       <span class="comment">//populate the buffer with the command</span>
00448       sprintf(buffer, <span class="stringliteral">"%s%s%s"</span>, pre, command, post);
00449     }
00450       
00451 
00452 
00453   <span class="comment">//fork the program to execute the command</span>
00454   <span class="keywordtype">int</span> pid = fork();
00455 
00456   <span class="comment">//if we are the child...</span>
00457   <span class="keywordflow">if</span>(pid == 0)
00458     {
00459       <span class="comment">//update the history file</span>
00460       <a class="code" href="comboHandlers_8h.html#a3">writeHistory</a>(command, history_file);
00461 
00462       <span class="comment">//populate the command to execute </span>
00463       <span class="keywordtype">char</span> * argv[4];
00464       argv[0] = <span class="stringliteral">"sh"</span>;
00465       argv[1] = <span class="stringliteral">"-c"</span>;
00466       argv[2] = (<span class="keywordtype">char</span> *)buffer;
00467       argv[3] = 0;
00468 <span class="comment"></span>
00469 <span class="comment">      /**\warning</span>
00470 <span class="comment">         NOTE: this function is a potential security problem because we are not</span>
00471 <span class="comment">         replacing the environment. if this is ever going to be a SUID</span>
00472 <span class="comment">         application then I need to handle this. I'll work on this in the</span>
00473 <span class="comment">         future -parasyte</span>
00474 <span class="comment">      */</span>
00475       <span class="comment">//execute the program</span>
00476       execve(<span class="stringliteral">"/bin/sh"</span>, argv, environ);
00477       
00478       <span class="comment">//free memory</span>
00479       g_free(buffer);
00480 
00481       <span class="comment">//exit properly</span>
00482       exit(0);
00483     }
00484   <span class="keywordflow">else</span>
00485     {
00486       g_free(buffer);
00487 
00488       <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a1">die</a>)
00489         {
00490           <span class="comment">//kill the main program</span>
00491           gtk_main_quit();
00492         }
00493       <span class="keywordflow">else</span>
00494         {
00495           <span class="comment">//update the history list</span>
00496           <a class="code" href="callbacks_8h.html#a18">combo_init</a>(combo_mode);
00497         }
00498     }
00499 }
</pre></div>    </td>
  </tr>
</table>

<p>
Here is the call graph for this function:<p><center><img src="main_8c_a6_cgraph.png" border="0" usemap="#main_8c_a6_cgraph_map" alt=""></center>
<map name="main_8c_a6_cgraph_map">
<area href="callbacks_8h.html#a18" shape="rect" coords="163,5,235,24" alt="">
<area href="comboHandlers_8h.html#a3" shape="rect" coords="159,48,239,66" alt="">
</map>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="main.c::environ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char** <a class="el" href="main_8c.html#a4">environ</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
the environment 
<p>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00071">71</a> of file <a class="el" href="main_8c-source.html">main.c</a>.
<p>
Referenced by <a class="el" href="main_8c-source.html#l00380">run_command()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="main.c::optarg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char* <a class="el" href="main_8c.html#a0">optarg</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
command line options 
<p>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00067">67</a> of file <a class="el" href="main_8c-source.html">main.c</a>.
<p>
Referenced by <a class="el" href="main_8c-source.html#l00078">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="main.c::opterr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int <a class="el" href="main_8c.html#a2">opterr</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
option arguments 
<p>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00069">69</a> of file <a class="el" href="main_8c-source.html">main.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="main.c::optind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int <a class="el" href="main_8c.html#a1">optind</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
option arguments 
<p>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00069">69</a> of file <a class="el" href="main_8c-source.html">main.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="main.c::optopt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int <a class="el" href="main_8c.html#a3">optopt</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
option arguments 
<p>

<p>
Definition at line <a class="el" href="main_8c-source.html#l00069">69</a> of file <a class="el" href="main_8c-source.html">main.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Wed Mar 17 14:38:23 2004 for run-free by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
