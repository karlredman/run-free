<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="copyright" content="Karl N. Redman 2004">
<meta name="keywords" content="run-free,GUI,command line launcher,application,xfree86,bash_history">
<meta name="description" content="run-free is a GUI command line lauching application for Xwindows">
<TITLE>run-free: GUI Command Line Launcher</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</head>
<BODY BGCOLOR="#FFFFFF">
<font size="-3">
<center>
<table>
<tr>
	<td><a href="http://run-free.sourceforge.net" target="top">Project Homepage</a></td>
	<td><a href="http://sourceforge.net/projects/run-free/" target="top">Sourceforge Page</a></td>
	<td><a href="http://cvs.sourceforge.net/viewcvs.py/run-free/" target="top">CVS Repository</a></td>
	<td><a href="http://freshmeat.net/projects/run-free/" target="top">Freshmeat.net Page</a></td>
	<td><a href="http://sourceforge.net/project/showfiles.php?group_id=39135&package_id=31325" target="top">Download project</a></td>
	<td><a href="http://www.sleepingstill.com" target="top">Author's Homepage</a></td>
</tr>
</table>
</center>
</font>
<hr>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>callbacks.c</h1><a href="callbacks_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*!\file callbacks.c</span>
00002 <span class="comment">  \brief callback function deffinitions</span>
00003 <span class="comment">*/</span>
00004 <span class="comment">/* NOTICE:</span>
00005 <span class="comment">    Copyright (C) 2004  Karl N. Redman (SleepingStill.com)</span>
00006 <span class="comment"></span>
00007 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
00008 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
00009 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
00010 <span class="comment">    (at your option) any later version.</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
00013 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00014 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00015 <span class="comment">    GNU General Public License for more details.</span>
00016 <span class="comment"></span>
00017 <span class="comment">    You should have received a copy of the GNU General Public License</span>
00018 <span class="comment">    along with this program; if not, write to the Free Software</span>
00019 <span class="comment">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00020 <span class="comment"></span>
00021 <span class="comment">    For further information contact: parasyte@sleepingstill.com</span>
00022 <span class="comment">*/</span>
00023 
00024 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;config.h&gt;</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#include &lt;gtk/gtk.h&gt;</span>
00029 <span class="preprocessor">#include &lt;gtk/gtkcombo.h&gt;</span>
00030 <span class="preprocessor">#include &lt;gdk/gdkkeysyms.h&gt;</span>
00031 
00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00035 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00036 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00037 
00038 <span class="preprocessor">#include "<a class="code" href="callbacks_8h.html">callbacks.h</a>"</span>
00039 <span class="preprocessor">#include "<a class="code" href="interface_8h.html">interface.h</a>"</span>
00040 <span class="preprocessor">#include "<a class="code" href="support_8h.html">support.h</a>"</span>
00041 
00042 <span class="preprocessor">#include "<a class="code" href="comboHandlers_8h.html">comboHandlers.h</a>"</span>
00043 <span class="preprocessor">#include "<a class="code" href="comboBox_8h.html">comboBox.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="main_8h.html">main.h</a>"</span>
00045 <span class="comment"></span>
00046 <span class="comment">/// whether the "options" box is up (disabled)</span>
<a name="l00047"></a><a class="code" href="callbacks_8c.html#a1">00047</a> <span class="comment"></span>gboolean <a class="code" href="callbacks_8c.html#a1">vbox2Up</a> = FALSE;
00048 <span class="comment"></span>
00049 <span class="comment">/** </span>
00050 <span class="comment">    \brief called when the main window is destroyed</span>
00051 <span class="comment"></span>
00052 <span class="comment">    \author Karl N. Redman</span>
00053 <span class="comment"></span>
00054 <span class="comment">    \par Purpose: </span>
00055 <span class="comment">        cleans up before exiting</span>
00056 <span class="comment">*/</span>
00057 <span class="keywordtype">void</span>
<a name="l00058"></a><a class="code" href="callbacks_8h.html#a0">00058</a> <a class="code" href="callbacks_8h.html#a0">on_mainWindow_destroy</a>                  (GtkObject       *object,
00059                                         gpointer         user_data)
00060 {
00061   <span class="comment">//cleanup</span>
00062   <a class="code" href="comboHandlers_8h.html#a1">freeList</a>(<a class="code" href="comboBox_8h.html#a3">cbitems</a>);
00063   g_free(<a class="code" href="main_8h.html#a5">history_file</a>);
00064   g_free(<a class="code" href="main_8h.html#a4">home_directory</a>);
00065   g_free(<a class="code" href="main_8h.html#a8">command</a>);
00066   g_free(<a class="code" href="main_8h.html#a7">terminal_path</a>);
00067 
00068   <span class="comment">//die</span>
00069   gtk_main_quit();
00070 }
00071 
00072 
00073 <span class="keywordtype">void</span>
<a name="l00074"></a><a class="code" href="callbacks_8h.html#a1">00074</a> <a class="code" href="callbacks_8h.html#a1">on_combo_entry1_changed</a>                (GtkEditable     *editable,
00075                                         gpointer         user_data)
00076 {
00077 
00078 }
00079 
00080 gboolean 
<a name="l00081"></a><a class="code" href="callbacks_8h.html#a3">00081</a> <a class="code" href="callbacks_8h.html#a3">on_combo_key_press_event</a>                (GtkWidget       *widget,
00082                                         GdkEventKey     *event,
00083                                         gpointer         user_data)
00084 {
00085   <span class="keywordflow">return</span> TRUE;
00086 }
00087 <span class="comment"></span>
00088 <span class="comment">/** </span>
00089 <span class="comment">    \brief handle when a keypress event occures in the combo box.</span>
00090 <span class="comment"></span>
00091 <span class="comment">    \author Karl N. Redman</span>
00092 <span class="comment"></span>
00093 <span class="comment">    \note</span>
00094 <span class="comment">    This is a lengthy function for now. run-free 3.0 will handle this</span>
00095 <span class="comment">    better in the futue. For now we just handle the common</span>
00096 <span class="comment">    functionality of the application from here</span>
00097 <span class="comment">*/</span>
00098 gboolean
<a name="l00099"></a><a class="code" href="callbacks_8h.html#a2">00099</a> <a class="code" href="callbacks_8h.html#a2">on_combo_entry1_key_press_event</a>        (GtkWidget       *widget,
00100                                         GdkEventKey     *event,
00101                                         gpointer         user_data)
00102 {
00103   <span class="comment">//save the previous key press (for control chars)</span>
00104   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> prevKey =0;
00105 
00106   <span class="keywordflow">if</span>(event-&gt;keyval == GDK_Return ||
00107      event-&gt;keyval == GDK_KP_Enter) <span class="comment">// run command</span>
00108     {
00109       <span class="keywordflow">if</span>(strcmp(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)), <span class="stringliteral">""</span>) !=0 &amp;&amp;
00110          gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)) != NULL)
00111         {
00112           <a class="code" href="comboHandlers_8h.html#a3">writeHistory</a>(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)), <a class="code" href="main_8h.html#a5">history_file</a>);
00113           <a class="code" href="main_8h.html#a10">run_command</a>(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)));
00114 
00115           gtk_widget_grab_focus(GTK_WIDGET(GTK_COMBO (<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry));
00116         }
00117       <span class="keywordflow">return</span> TRUE;
00118     }
00119   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval == GDK_u)
00120     {
00121       <span class="keywordflow">if</span>(prevKey == GDK_Alt_L || prevKey == GDK_Alt_R)
00122         {
00123           <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a1">die</a>)
00124             <a class="code" href="main_8h.html#a1">die</a>=FALSE;
00125           <span class="keywordflow">else</span>
00126             <a class="code" href="main_8h.html#a1">die</a>=TRUE;
00127         }
00128       }
00129   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval == GDK_y)
00130     {
00131       <span class="keywordflow">if</span>(prevKey == GDK_Alt_L || prevKey == GDK_Alt_R)
00132         {
00133           <span class="keywordflow">if</span>(<a class="code" href="main_8h.html#a3">keep_open</a>)
00134             <a class="code" href="main_8h.html#a3">keep_open</a>=FALSE;
00135           <span class="keywordflow">else</span>
00136             <a class="code" href="main_8h.html#a3">keep_open</a>=TRUE;
00137         }
00138       }
00139   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval == GDK_h)
00140     {
00141       <span class="keywordflow">if</span>(prevKey == GDK_Alt_L || prevKey == GDK_Alt_R)
00142         {
00143           <a class="code" href="interface_8c.html#a2">keystrokes_dialog</a>();
00144         }
00145       }
00146   <span class="keywordflow">if</span>(event-&gt;keyval == GDK_space)
00147   {
00148       <span class="keywordflow">if</span>(prevKey == GDK_Control_L || prevKey == GDK_Control_R ||
00149         prevKey == GDK_Alt_L || prevKey == GDK_Alt_R)
00150         {
00151           gint x =0, y =0, 
00152             height =0, width =0, 
00153             old_height =0, old_width =0; 
00154 
00155           <span class="comment">//we have to grab the combo position</span>
00156           <a class="code" href="callbacks_8h.html#a19">gtk_combo_get_pos</a>(GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>), &amp;x, &amp;y, &amp;height, &amp;width);
00157 
00158           <span class="comment">//see if we have the focus</span>
00159           <span class="keywordflow">if</span> (!GTK_WIDGET_HAS_FOCUS (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry))
00160             gtk_widget_grab_focus (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry);
00161           
00162           <span class="comment">//deliver all events to the popwin</span>
00163           gtk_grab_add (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin);
00164 
00165           <span class="comment">//grab ponter (mouse) and all other events</span>
00166           gdk_pointer_grab (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin-&gt;window, TRUE,
00167                             GDK_BUTTON_PRESS_MASK | 
00168                             GDK_BUTTON_RELEASE_MASK |
00169                             GDK_POINTER_MOTION_MASK, 
00170                             NULL, NULL, GDK_CURRENT_TIME);
00171 
00172           <span class="comment">/* I don't know why this is being evil but the widget needs</span>
00173 <span class="comment">             to be resized...</span>
00174 <span class="comment">           */</span>
00175           <span class="keywordflow">if</span> (width != old_width || height != old_height)
00176             {
00177               gtk_widget_hide (GTK_SCROLLED_WINDOW
00178                                (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popup)-&gt;hscrollbar);
00179 
00180               gtk_widget_hide (GTK_SCROLLED_WINDOW
00181                                (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popup)-&gt;vscrollbar);
00182             }
00183           
00184           <span class="comment">//set the position of the listbox</span>
00185           gtk_widget_set_uposition (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin, x, y);
00186           gtk_widget_set_usize (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin, width, height);
00187           gtk_widget_realize (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin);
00188           gdk_window_resize (GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin-&gt;window, width, height);
00189           
00190           gtk_widget_show(GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;popwin);
00191         }
00192       <span class="keywordflow">return</span> FALSE;
00193   } 
00194   <span class="keywordflow">else</span>
00195     <span class="keywordflow">if</span>(event-&gt;keyval == GDK_Control_L || event-&gt;keyval == GDK_Control_R ||
00196        event-&gt;keyval == GDK_Alt_L || event-&gt;keyval ==GDK_Alt_R)
00197       prevKey = event-&gt;keyval;
00198     <span class="keywordflow">else</span>
00199       prevKey = 0;
00200     
00201   <span class="keywordflow">return</span> FALSE;
00202 }
00203 
00204 
00205 <span class="keywordtype">void</span>
<a name="l00206"></a><a class="code" href="callbacks_8h.html#a4">00206</a> <a class="code" href="callbacks_8h.html#a4">on_browseButton_clicked</a>                (GtkButton       *button,
00207                                         gpointer         user_data)
00208 {
00209   gtk_widget_show (<a class="code" href="interface_8h.html#a1">fileselection</a>);
00210 }
00211 
00212 <span class="comment"></span>
00213 <span class="comment">/** </span>
00214 <span class="comment">    \brief handle setting the run_in_term mode</span>
00215 <span class="comment"></span>
00216 <span class="comment">    \author Karl N. Redman</span>
00217 <span class="comment"></span>
00218 <span class="comment">    \par Purpose: </span>
00219 <span class="comment">        Toggle between run_in_term and normal (exit) modes of</span>
00220 <span class="comment">    operation</span>
00221 <span class="comment">*/</span>
00222 <span class="keywordtype">void</span>
<a name="l00223"></a><a class="code" href="callbacks_8h.html#a5">00223</a> <a class="code" href="callbacks_8h.html#a5">on_checkbutton_toggled</a>                 (GtkToggleButton *togglebutton,
00224                                         gpointer         user_data)
00225 {
00226   <span class="keywordflow">if</span>(!<a class="code" href="main_8h.html#a0">run_in_term</a>)
00227     <a class="code" href="main_8h.html#a0">run_in_term</a> = TRUE;
00228   <span class="keywordflow">else</span>
00229     <a class="code" href="main_8h.html#a0">run_in_term</a> = FALSE;
00230 }
00231 
00232 <span class="comment"></span>
00233 <span class="comment">/** </span>
00234 <span class="comment">    \brief Handle the OK button clicked in the fileselection dialog.</span>
00235 <span class="comment"></span>
00236 <span class="comment">    \author Karl N. Redman</span>
00237 <span class="comment"></span>
00238 <span class="comment">    \par Purpose: </span>
00239 <span class="comment">        Sets the combo box entry and hides the fileselection</span>
00240 <span class="comment">    dialog.</span>
00241 <span class="comment">*/</span>
00242 <span class="keywordtype">void</span>
<a name="l00243"></a><a class="code" href="callbacks_8h.html#a6">00243</a> <a class="code" href="callbacks_8h.html#a6">on_ok_button1_clicked</a>                  (GtkButton       *button,
00244                                         gpointer         user_data)
00245 {
00246   <span class="comment">//space and null are the +1's</span>
00247   <span class="keywordtype">char</span> s[strlen(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)))
00248          +1 
00249          + strlen( gtk_file_selection_get_filename(GTK_FILE_SELECTION(<a class="code" href="interface_8h.html#a1">fileselection</a>)))
00250          +1]; 
00251   
00252   <span class="comment">//set the combo box string</span>
00253   sprintf(s, <span class="stringliteral">"%s %s"</span>, gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)), gtk_file_selection_get_filename(GTK_FILE_SELECTION(<a class="code" href="interface_8h.html#a1">fileselection</a>)));
00254 
00255   <span class="comment">//set the entry</span>
00256   gtk_entry_set_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry), s);
00257 
00258   <span class="comment">//hide the file dialog</span>
00259   gtk_widget_hide (<a class="code" href="interface_8h.html#a1">fileselection</a>);
00260 <span class="comment"></span>
00261 <span class="comment">  /**\todo </span>
00262 <span class="comment">     clear the file selection by stripping off the file name ?</span>
00263 <span class="comment">   */</span>
00264   
00265 }
00266 
00267 
00268 <span class="keywordtype">void</span>
<a name="l00269"></a><a class="code" href="callbacks_8h.html#a7">00269</a> <a class="code" href="callbacks_8h.html#a7">on_cancel_button1_clicked</a>              (GtkButton       *button,
00270                                         gpointer         user_data)
00271 {
00272   gtk_widget_hide (<a class="code" href="interface_8h.html#a1">fileselection</a>);
00273 }
00274 
00275 
00276 gboolean
<a name="l00277"></a><a class="code" href="callbacks_8h.html#a8">00277</a> <a class="code" href="callbacks_8h.html#a8">on_fileselection_key_press_event</a>       (GtkWidget       *widget,
00278                                         GdkEventKey     *event,
00279                                         gpointer         user_data)
00280 {
00281   <span class="keywordflow">if</span>(event-&gt;keyval == GDK_Escape) <span class="comment">// quit</span>
00282     {
00283       <span class="comment">//cancel operations</span>
00284       gtk_button_clicked(GTK_BUTTON(GTK_FILE_SELECTION(widget)-&gt;cancel_button));
00285     }
00286   <span class="keywordflow">return</span> FALSE;
00287 }
00288 
00289 <span class="comment"></span>
00290 <span class="comment">/** </span>
00291 <span class="comment">    \brief Handle a keypress event at the toplevel window level</span>
00292 <span class="comment"></span>
00293 <span class="comment">    \author Karl N. Redman</span>
00294 <span class="comment"></span>
00295 <span class="comment">    \par Purpose: </span>
00296 <span class="comment">        Takes care of default keystrokes (closing the App. etc.).</span>
00297 <span class="comment">*/</span>
00298 gboolean
<a name="l00299"></a><a class="code" href="callbacks_8h.html#a9">00299</a> <a class="code" href="callbacks_8h.html#a9">on_mainWindow_key_press_event</a>          (GtkWidget       *widget,
00300                                         GdkEventKey     *event,
00301                                         gpointer         user_data)
00302 {
00303   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> prevKey =0;
00304 
00305   <span class="comment">//return on_combo_entry1_key_press_event(widget, event, user_data);</span>
00306   <span class="keywordflow">if</span>(event-&gt;keyval == GDK_Escape) <span class="comment">// quit</span>
00307     {
00308       <span class="comment">//cancel operations -"destroy"</span>
00309       gtk_main_quit();
00310     }
00311   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval ==GDK_c)
00312     {
00313       gtk_widget_grab_focus(GTK_WIDGET(GTK_COMBO (<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry));
00314     }
00315   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval == GDK_m) <span class="comment">// history mode -should be anaccelerator</span>
00316     {
00317       <span class="keywordflow">if</span>(prevKey == GDK_Control_L || prevKey == GDK_Control_R)
00318         {
00319           <span class="keywordflow">if</span>(<a class="code" href="comboBox_8h.html#a4">combo_mode</a> &lt; <a class="code" href="comboBox_8h.html#a2">RF_MAX_MODE</a>)
00320             <a class="code" href="comboBox_8h.html#a4">combo_mode</a>++;
00321           <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="comboBox_8h.html#a4">combo_mode</a> &gt;= <a class="code" href="comboBox_8h.html#a2">RF_MAX_MODE</a>)
00322             <a class="code" href="comboBox_8h.html#a4">combo_mode</a> = <a class="code" href="comboBox_8h.html#a1">RF_HISTORY_MODE</a>;
00323         
00324           <a class="code" href="callbacks_8h.html#a18">combo_init</a>(<a class="code" href="comboBox_8h.html#a4">combo_mode</a>);
00325         }
00326     }
00327   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(event-&gt;keyval == GDK_h)
00328     {
00329       <span class="keywordflow">if</span>(prevKey == GDK_Alt_L || prevKey == GDK_Alt_R)
00330         {
00331           <a class="code" href="interface_8c.html#a2">keystrokes_dialog</a>();
00332         }
00333       }
00334   <span class="keywordflow">else</span>
00335     <span class="keywordflow">if</span>(event-&gt;keyval == GDK_Control_L || event-&gt;keyval == GDK_Control_R)
00336       prevKey = event-&gt;keyval;
00337     <span class="keywordflow">else</span>
00338       prevKey = 0;
00339   <span class="keywordflow">return</span> FALSE;
00340 }
00341 <span class="comment"></span>
00342 <span class="comment">/** </span>
00343 <span class="comment">    \brief Execute the command in the combo entry box.</span>
00344 <span class="comment"></span>
00345 <span class="comment">    \author Karl N. Redman</span>
00346 <span class="comment"></span>
00347 <span class="comment">    \par Purpose: </span>
00348 <span class="comment">        Write to the history file and execute the command in the</span>
00349 <span class="comment">    entry box.</span>
00350 <span class="comment">*/</span>
00351 <span class="keywordtype">void</span>
<a name="l00352"></a><a class="code" href="callbacks_8h.html#a10">00352</a> <a class="code" href="callbacks_8h.html#a10">on_runButton_clicked</a>                    (GtkButton       *button,
00353                                          gpointer         user_data)
00354 {
00355   <span class="keywordflow">if</span>(strcmp(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)), <span class="stringliteral">""</span>) !=0 &amp;&amp;
00356      gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)) != NULL)
00357     {
00358       <a class="code" href="comboHandlers_8h.html#a3">writeHistory</a>(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)), <a class="code" href="main_8h.html#a5">history_file</a>);
00359       <a class="code" href="main_8h.html#a10">run_command</a>(gtk_entry_get_text(GTK_ENTRY( GTK_COMBO(<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry)));
00360     }
00361 }
00362 <span class="comment"></span>
00363 <span class="comment">/** </span>
00364 <span class="comment">    \brief Handle the options mode selection</span>
00365 <span class="comment"></span>
00366 <span class="comment">    \author Karl N. Redman</span>
00367 <span class="comment"></span>
00368 <span class="comment">    \par Purpose: </span>
00369 <span class="comment">        Resize the main window and display the options allowed by</span>
00370 <span class="comment">    the options mode of operation.</span>
00371 <span class="comment">*/</span>
00372 <span class="keywordtype">void</span>
<a name="l00373"></a><a class="code" href="callbacks_8h.html#a11">00373</a> <a class="code" href="callbacks_8h.html#a11">on_optionsButton_clicked</a>               (GtkButton       *button,
00374                                         gpointer         user_data)
00375 {
00376   <span class="comment">//TODO (this needs to be made more intuitive!!!)</span>
00377   <span class="keyword">static</span> gboolean up = TRUE;
00378 <span class="comment"></span>
00379 <span class="comment">  /*! \note in order to resize the window we have to mess with the</span>
00380 <span class="comment">    window policy of the mainWindow. This is pretty clumbsy here.</span>
00381 <span class="comment">  */</span>
00382   <span class="keywordflow">if</span>(up)
00383     gtk_window_set_policy (GTK_WINDOW (<a class="code" href="interface_8h.html#a0">mainWindow</a>), FALSE, FALSE, FALSE);
00384   <span class="keywordflow">else</span>
00385     gtk_window_set_policy (GTK_WINDOW (<a class="code" href="interface_8h.html#a0">mainWindow</a>), FALSE, FALSE, TRUE);
00386 
00387   <a class="code" href="callbacks_8c.html#a14">handle_options_display</a>();
00388   gtk_window_set_policy (GTK_WINDOW (<a class="code" href="interface_8h.html#a0">mainWindow</a>), TRUE, TRUE, TRUE);
00389 
00390   <span class="keywordflow">if</span>(up)
00391     up=TRUE;
00392   <span class="keywordflow">else</span>
00393     up=FALSE;
00394 }<span class="comment"></span>
00395 <span class="comment">/** </span>
00396 <span class="comment">    \brief Handle options display</span>
00397 <span class="comment"></span>
00398 <span class="comment">    \author Karl N. Redman</span>
00399 <span class="comment"></span>
00400 <span class="comment">    \par Purpose: </span>
00401 <span class="comment">        Handle mainWindow resizing when Options are desired</span>
00402 <span class="comment">*/</span>
<a name="l00403"></a><a class="code" href="callbacks_8h.html#a16">00403</a> <span class="keywordtype">void</span> <a class="code" href="callbacks_8c.html#a14">handle_options_display</a>()
00404 {
00405   <span class="keywordflow">if</span>(<a class="code" href="callbacks_8c.html#a1">vbox2Up</a>)
00406     {
00407       <span class="keywordtype">int</span> x;
00408       <span class="keywordtype">int</span> y;
00409 <span class="comment"></span>
00410 <span class="comment">      ///set the focus to the combo box</span>
00411 <span class="comment"></span>      gtk_widget_grab_focus(GTK_WIDGET(GTK_COMBO (<a class="code" href="interface_8h.html#a4">combo1</a>)-&gt;entry));
00412       <span class="comment"></span>
00413 <span class="comment">      ///hide the vbox</span>
00414 <span class="comment"></span>      gtk_widget_hide (<a class="code" href="interface_8h.html#a3">vbox2</a>);
00415 <span class="comment"></span>
00416 <span class="comment">      /// resize the main window</span>
00417 <span class="comment"></span>      gdk_window_get_origin(<a class="code" href="interface_8h.html#a0">mainWindow</a>-&gt;window, &amp;x, &amp;y);
00418       gdk_window_move (<a class="code" href="interface_8h.html#a0">mainWindow</a>-&gt;window, x, y);
00419       
00420       <span class="comment">//set the flag</span>
00421       <a class="code" href="callbacks_8c.html#a1">vbox2Up</a> = FALSE;
00422     }
00423   <span class="keywordflow">else</span>
00424     {
00425       <span class="comment">//show the vbox</span>
00426       gtk_widget_show (<a class="code" href="interface_8h.html#a3">vbox2</a>);
00427       <a class="code" href="callbacks_8c.html#a1">vbox2Up</a> = TRUE;
00428     }
00429 }
00430 
00431 
00432 <span class="keywordtype">void</span>
<a name="l00433"></a><a class="code" href="callbacks_8h.html#a14">00433</a> <a class="code" href="callbacks_8h.html#a14">on_whoEntry_grab_focus</a>                 (GtkWidget       *widget,
00434                                         gpointer         user_data)
00435 {
00436   <span class="keywordflow">if</span>(!<a class="code" href="callbacks_8c.html#a1">vbox2Up</a>)
00437     <a class="code" href="callbacks_8c.html#a14">handle_options_display</a>();
00438 }
00439 
00440 
00441 <span class="keywordtype">void</span>
<a name="l00442"></a><a class="code" href="callbacks_8h.html#a15">00442</a> <a class="code" href="callbacks_8h.html#a15">on_passwordEntry_grab_focus</a>            (GtkWidget       *widget,
00443                                         gpointer         user_data)
00444 {
00445   <span class="keywordflow">if</span>(!<a class="code" href="callbacks_8c.html#a1">vbox2Up</a>)
00446     <a class="code" href="callbacks_8c.html#a14">handle_options_display</a>();
00447 }
00448 
00449 gboolean
<a name="l00450"></a><a class="code" href="callbacks_8h.html#a17">00450</a> <a class="code" href="callbacks_8h.html#a17">on_fileselection_delete_event</a>          (GtkWidget       *widget,
00451                                         GdkEvent        *event,
00452                                         gpointer         user_data)
00453 {
00454   gtk_widget_hide (<a class="code" href="interface_8h.html#a1">fileselection</a>);
00455   <span class="keywordflow">return</span> TRUE;
00456 }
00457 
00458 
00459 
00460 
<a name="l00461"></a><a class="code" href="callbacks_8c.html#a0">00461</a> <span class="preprocessor">#define EMPTY_LIST_HEIGHT   (15)</span>
00462 <span class="preprocessor"></span><span class="comment">/** </span>
00463 <span class="comment">    \brief figure out the combo box positions</span>
00464 <span class="comment"></span>
00465 <span class="comment">    \author NOT ME! whoever wrote gtkhacks...</span>
00466 <span class="comment">    </span>
00467 <span class="comment">    \warning This function is "borrowed" from gtkhacks of glade (i think)</span>
00468 <span class="comment">    </span>
00469 <span class="comment">    </span>
00470 <span class="comment">    \par Purpose: </span>
00471 <span class="comment">    grab the position of the combo box</span>
00472 <span class="comment">    </span>
00473 <span class="comment">    \todo </span>
00474 <span class="comment">    REDO THIS FUNCTION! This function is not mine! (see gtkhacks)</span>
00475 <span class="comment">        </span>
00476 <span class="comment">*/</span>
00477 
00478 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00479"></a><a class="code" href="callbacks_8c.html#a18">00479</a> <a class="code" href="callbacks_8h.html#a19">gtk_combo_get_pos</a> (GtkCombo * combo,
00480                    gint * x,
00481                    gint * y,
00482                    gint * height,
00483                    gint * width)
00484 {
00485         GtkBin *popwin;
00486         GtkWidget *widget;
00487         GtkScrolledWindow *popup;
00488 
00489         gint real_height;
00490         GtkRequisition list_requisition;
00491         gboolean show_hscroll = FALSE;
00492         gboolean show_vscroll = FALSE;
00493         gint avail_height;
00494         gint min_height;
00495         gint alloc_width;
00496         gint work_height;
00497         gint old_height;
00498         gint old_width;
00499 
00500         widget = GTK_WIDGET(combo);
00501         popup  = GTK_SCROLLED_WINDOW (combo-&gt;popup);
00502         popwin = GTK_BIN (combo-&gt;popwin);
00503 
00504         gtk_widget_realize(GTK_WIDGET(combo-&gt;entry));
00505         gdk_window_get_origin (combo-&gt;entry-&gt;window, x, y);
00506         real_height = MIN (combo-&gt;entry-&gt;requisition.height,
00507                            combo-&gt;entry-&gt;allocation.height);
00508         *y += real_height;
00509         avail_height = gdk_screen_height () - *y;
00510 
00511         gtk_widget_size_request (combo-&gt;list, &amp;list_requisition);
00512         min_height = MIN (list_requisition.height,
00513                           popup-&gt;vscrollbar-&gt;requisition.height);
00514         <span class="keywordflow">if</span> (!GTK_LIST (combo-&gt;list)-&gt;children)
00515                 list_requisition.height += <a class="code" href="callbacks_8c.html#a0">EMPTY_LIST_HEIGHT</a>;
00516 
00517         alloc_width = (widget-&gt;allocation.width -
00518              2 * popwin-&gt;child-&gt;style-&gt;klass-&gt;xthickness -
00519              2 * GTK_CONTAINER (popwin-&gt;child)-&gt;border_width -
00520              2 * GTK_CONTAINER (combo-&gt;popup)-&gt;border_width -
00521              2 * GTK_CONTAINER (GTK_BIN (popup)-&gt;child)-&gt;border_width -
00522              2 * GTK_BIN (popup)-&gt;child-&gt;style-&gt;klass-&gt;xthickness);
00523 
00524         work_height = (2 * popwin-&gt;child-&gt;style-&gt;klass-&gt;ythickness +
00525              2 * GTK_CONTAINER (popwin-&gt;child)-&gt;border_width +
00526              2 * GTK_CONTAINER (combo-&gt;popup)-&gt;border_width +
00527              2 * GTK_CONTAINER (GTK_BIN (popup)-&gt;child)-&gt;border_width +
00528              2 * GTK_BIN (popup)-&gt;child-&gt;style-&gt;klass-&gt;xthickness);
00529 
00530         <span class="keywordflow">do</span> {
00531                 old_width = alloc_width;
00532                 old_height = work_height;
00533 
00534                 <span class="keywordflow">if</span> (!show_hscroll &amp;&amp;
00535                     alloc_width &lt; list_requisition.width) {
00536                           work_height += popup-&gt;hscrollbar-&gt;requisition.height
00537                                          + GTK_SCROLLED_WINDOW_CLASS
00538                                            (GTK_OBJECT (combo-&gt;popup)-&gt;klass)-&gt;scrollbar_spacing;
00539                           show_hscroll = TRUE;
00540                 }
00541             <span class="keywordflow">if</span> (!show_vscroll &amp;&amp;
00542                 work_height + list_requisition.height &gt; avail_height) {
00543                     <span class="keywordflow">if</span> (work_height + min_height &gt; avail_height &amp;&amp;
00544                         *y - real_height &gt; avail_height) {
00545                                 *y -= (work_height +
00546                                        list_requisition.height +
00547                                        real_height);
00548                                 <span class="keywordflow">break</span>;
00549                     }
00550                     alloc_width -= popup-&gt;vscrollbar-&gt;requisition.width +
00551                                    GTK_SCROLLED_WINDOW_CLASS
00552                                   (GTK_OBJECT (combo-&gt;popup)-&gt;klass)-&gt;scrollbar_spacing;
00553                     show_vscroll = TRUE;
00554             }
00555         } <span class="keywordflow">while</span> (old_width != alloc_width || old_height != work_height);
00556 
00557         *width = widget-&gt;allocation.width;
00558         <span class="keywordflow">if</span> (show_vscroll)
00559                 *height = avail_height;
00560         <span class="keywordflow">else</span>
00561                 *height = work_height + list_requisition.height;
00562 
00563         <span class="keywordflow">if</span> (*x &lt; 0)
00564                 *x = 0;
00565 }
00566 
00567 <span class="keywordtype">void</span>
<a name="l00568"></a><a class="code" href="callbacks_8h.html#a20">00568</a> <a class="code" href="callbacks_8h.html#a20">dialog_ok_clicked</a>                       (GtkButton       *button,
00569                                         gpointer         user_data)
00570 {
00571   gtk_widget_destroy(GTK_WIDGET(user_data));
00572 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Mar 17 16:19:43 2004 for run-free by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
